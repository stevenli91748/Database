* [缓存概述](#缓存概述)
  * [Cache 概述](https://jverson.com/spring-boot-demo/cache/cache-0-introduction.html)
* [缓存种类](#缓存种类)
  * [Client caching]
  * [HTTP  Caching]  
    * [HTTP----HTTP缓存机制](https://juejin.im/post/5a1d4e546fb9a0450f21af23)
  * [CDN caching]
  * [Web server caching ]
  * [Database caching]
  * [Application caching]
  * [Caching at database query level]
  * [Caching at object level]
  * [When to update the cache]
    * [Cache aside]
    * [Write through]
    * [Write behind]
    * [Refresh ahead]

* 缓存架构设计要点
  * [缓存穿透](#缓存穿透)
  * [缓存雪崩](#缓存雪崩)
  * [缓存热点](#缓存热点)
  * [缓存预热](#缓存预热)

# 缓存概述 
     
  
     
     缓存就是为了弥补存储系统在某些复杂业务场景下的不足， 缓存的基本原理就是将可能重复使用的数据放到内存中，一次生成，多次使用， 避免每次使用都去访问
     存储系统。虽然我们可以通过各种手段来提升存储系统的性能，但在某些复杂的业务场景下，单纯依靠存储系统的性能提升不够的，典型的场景如下。
     
     （l）需要经过复杂运算后得出的数据，存储系统无能为力。
     （2）读多写少的数据，存储系统有心无力。
     
    使用缓存减少对数据库的直接操作，减轻查询时的I/O压力。
    
# 缓存架构设计要点

   缓存虽然能够大大减轻存储系统的压力，但同时也给架构引入了更多复杂性。架构设计时如果没有针对缓存的复杂性进行处理，某些场景下甚至会导致整个系统
   崩溃。接下来我们逐一 分析缓存的架构设计要点。    

## 缓存穿透

    缓存穿透是指缓存没有发挥作用，业务系统虽然去缓存中查询数据，但缓存中没有数据，业务系统需要再次去存储系统中查询数据。
    
    通常情况下有两种情况： 
    
    1. 存储数据不存在，
    
    2. 生成缓存数据需要耗费大量时间或资源。

## 缓存雪崩

     ﻿缓存雪崩是指当缓存失效（过期）后引起系统性能急剧下降的情况。当缓存过期被清除后，业务系统需要重新生成缓存，因此需要再次访问存储系统，再次进
      行运算，这个处理步骤耗时	 几十毫秒甚至上百毫秒。而对于一个高并发的业务系统来说，几百毫秒内可能会接到几百上千	 个请求。由于旧的缓存己经被
      清除，新的缓存还未生成，并且处理这些请求的线程都不知道另	 外有一个线程正在生成缓存，因此所有的请求都会去重新生成缓存，都会去访问存储系统，
      从而对存储系统造成巨大的性能压力。这些压力又会拖慢整个系统， 严重的会造成数据库右机，	 从而形成一系列连锁反应，造成整个系统崩溃。	 

**缓存雪崩的常见解决方法有两种：更新锁机制和后台更新机制**
  
  1. 更新锁机制
           
         对缓存更新操作进行加锁保护，保证只有一个线程能够进行缓存更新，未能获取更新锁的线程要么等待锁释放后重新读取缓存，要么就返回空值或默认值。
         对于采用分布式集群的业务系统，由于存在几十上百台服务器，即使单台服务器只有一个线程更新缓存，但几十上百台服务器一起算下来也会有几十上百个
         线程同时来更新缓存，同样存在雪崩的问题。因此分布式集群的业务系统要完美实现更新锁机制，需要用到分布式锁，如ZooKeeper 。
  
  * [ZooKeeper分布式锁]()
  
  2. 后台更新机制

          由后台线程来更新缓存，而不是由业务线程来更新缓存，缓存本身的有效期设置为永久，后台线程定时更新缓存。后台定时机制需要考虑一种特殊的场景，
          当缓存系统内存不够时，会“踢掉” 一些缓存数据，从缓存被“踢掉”到下一次定时更新缓存的这段时间内，业务线程读取缓存返回空值，而业务线程本身又
          不会去更新缓存，因此业务上看到的现象就是数据丢了。
          
          解决的方式有两种：
          
          (l）定时读取
          
              后台线程除了定时更新缓存，还要频繁地去读取缓存（例如， l 秒或100 毫秒读取一次） ，如果发现缓存被“踢了”就立刻更新缓存，这种方式实现
              简单，但读取时间间隔不能设置得太长，因为如果缓存被踢了，缓存读取间隔时间又太长，则这段时间内业务访问都拿不到真正的数据而是一个空的
              缓存值，用户体验一般。
          
          (2）消息队列通知
               
              业务线程发现缓存失效后，通过消息队列发送一条消息通知后台线程更新缓存。可能会出现多个业务线程都发送了缓存更新消息，但其实对后台线程
              没有影响，后台线程收到消息后更新缓存前可以判断缓存是否存在，存在就不执行更新操作。这种方式实现依赖消息队列，复杂度会高一些，但缓存
              更新更及时，用户体验更好。


## 缓存热点

     虽然缓存系统本身的性能比较高，但对于一些特别热点的数据，如果大部分甚至所有的业务请求都命中同一份缓存数据，则这份数据所在的缓存服务器的压力也很
     大

**缓存热点的解决方案**

     缓存热点的解决方案就是复制多份缓存， 将请求分散到多个缓存服务器上，减轻缓存热点导致的单台缓存服务器压力

## 缓存预热

    指系统上线后，将相关的缓存数据直接加载到缓存系统，而不是等待用户访问才来触发缓存加载。

# 缓存种类

     按照存放位置不同，可分为客户端缓存、服务端缓存。

     1.客户端缓存（主要是缓存页面）：

          浏览器缓存网关、代理服务器缓存

     2.服务端缓存：

        页面缓存（常通过发布系统生成静态页面，适用于信息发布类网站，或数据非频繁进行动态变化的部分）。缓存实现手段：可对页面整体缓存，
        也可以缓存片段，如ESI cache。使用CDN也算是一种缓存方式。

        数据缓存。
        缓存框架：ehcache

# 缓存视频

* [缓存击穿解决实战，保障系统并发能力](https://www.bilibili.com/video/av61006698)
* [系统稳如磐石，解决缓存击穿的终极办法](https://www.bilibili.com/video/av35897825/?spm_id_from=333.788.videocard.0)
* [什么是缓存雪崩？今晚前华为架构师带你真正理解缓存雪崩那些事儿](https://www.bilibili.com/video/av46230826/?spm_id_from=333.788.videocard.13)

# 有用的参考
* [缓存那些事---详细描述缓存知识点](https://tech.meituan.com/2017/03/17/cache-about.html)
* [架构真经 | 缓存为王](https://blog.csdn.net/qq_35246620/article/details/70234185)
* [一篇文读懂缓存在大型分布式系统中的最佳应用](https://blog.csdn.net/hotdust/article/details/73123598)
* [脚踏两只船的困惑 - Memcached与Redis](https://www.imooc.com/article/23549)
